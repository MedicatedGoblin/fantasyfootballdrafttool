<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fantasy Draft Tool</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');

body {
  font-family: 'Inter', sans-serif;
  background: #f5f7fa;
  color: #222;
  padding: 2rem;
  max-width: 1200px;
  margin: auto;
}

h2, h3 {
  font-weight: 600;
  color: #333;
  margin-bottom: 1rem;
}

.controls {
  margin-bottom: 1.5rem;
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  align-items: center;
}

.controls > * {
  flex-grow: 1;
  min-width: 120px;
}

input[type="file"] {
  border: 2px solid #ddd;
  padding: 0.4rem;
  border-radius: 6px;
  cursor: pointer;
  transition: border-color 0.3s ease;
}
input[type="file"]:hover,
input[type="file"]:focus {
  border-color: #007bff;
}

button {
  background-color: #007bff;
  border: none;
  color: white;
  padding: 0.6rem 1.2rem;
  font-weight: 600;
  border-radius: 6px;
  cursor: pointer;
  box-shadow: 0 3px 8px rgb(0 123 255 / 0.3);
  transition: background-color 0.3s ease, box-shadow 0.3s ease;
}
button:hover:not(:disabled) {
  background-color: #0056b3;
  box-shadow: 0 5px 12px rgb(0 86 179 / 0.5);
}
button:disabled {
  background-color: #a3c3f7;
  cursor: not-allowed;
  box-shadow: none;
}

input[type="text"],
select,
#searchInput {
  padding: 0.6rem 0.8rem;
  border-radius: 6px;
  border: 1.8px solid #ccc;
  transition: border-color 0.3s ease, box-shadow 0.3s ease;
  font-size: 1rem;
  min-width: 160px;
}
input[type="text"]:focus,
select:focus,
#searchInput:focus {
  border-color: #007bff;
  box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
  outline: none;
}

/* Error highlight */
.error {
  border-color: #e74c3c !important;
  background-color: #ffe6e6 !important;
  box-shadow: 0 0 8px rgba(231, 76, 60, 0.6);
}

/* Table Styling */
table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0 8px;
  background: white;
  box-shadow: 0 4px 12px rgb(0 0 0 / 0.1);
  border-radius: 8px;
  overflow: hidden;
}

thead tr {
  background-color: #007bff;
  color: white;
  font-weight: 600;
}

th, td {
  padding: 12px 15px;
  text-align: left;
}

tbody tr {
  background-color: #fefefe;
  border-radius: 6px;
  transition: background-color 0.3s ease;
  cursor: pointer;
  box-shadow: 0 2px 4px rgb(0 0 0 / 0.04);
}

tbody tr:hover {
  background-color: #e9f1ff;
}

tbody tr.strikethrough {
  color: #aaa;
  text-decoration: line-through;
  opacity: 0.6;
  cursor: default;
}

tbody tr.highlight {
  background-color: #ffeb3b !important; /* Bright solid yellow */
  color: #000; /* Pure black text for max contrast */
  font-weight: 900;
  border-left: 8px solid #fdd835; /* Strong gold accent */
  text-shadow: none;
  box-shadow: 0 0 0 3px #fbc02d; /* Solid bold outline */
  transform: scale(1.01);
}
tbody tr.highlight:hover {
  transform: scale(1.01);
  box-shadow: 0 0 18px rgba(255, 213, 0, 0.9);
}

tbody tr.recent-pick {
  border: 3px solid #ff8c00;
  background-color: #fff8e1 !important;
  font-weight: 700;
}

th:nth-child(1),
td:nth-child(1) {
  text-align: center;
  width: 40px;
}

input[type="checkbox"] {
  width: 22px;
  height: 22px;
  cursor: pointer;
  transition: transform 0.2s ease;
}

input[type="checkbox"]:hover {
  transform: scale(1.2);
}

/* Position colors */
.RB {
  background-color: #b2d8b2 !important;
  color: #1b4d1b;
  font-weight: 600;
}
.WR {
  background-color: #a8cce6 !important;
  color: #12375a;
  font-weight: 600;
}
.QB {
  background-color: #f6d9a5 !important;
  color: #6b5200;
  font-weight: 600;
}
.TE {
  background-color: #d4b3f7 !important;
  color: #431a85;
  font-weight: 600;
}

/* Buttons and Inputs Group */
#teamNames input {
  width: 100%;
  margin-bottom: 0.7rem;
  font-size: 1rem;
}

/* Pick number box */
.pick-number-box {
  display: inline-block;
  background: #ff8c00;
  color: black;
  font-weight: bold;
  padding: 2px 8px;
  border-radius: 4px;
  font-size: 0.75rem;
  margin-left: 8px;
  margin-top: 4px;
  vertical-align: middle;
  box-shadow: 0 2px 5px rgba(255, 140, 0, 0.5);
  border: 2px solid #ff8c00;
  white-space: nowrap;
}

/* My picks styling */
.my-picks div {
  background: white;
  box-shadow: 0 2px 8px rgb(0 0 0 / 0.1);
  border-radius: 8px;
  padding: 10px 12px;
  min-width: 140px;
  max-width: 200px;
  font-weight: 600;
  color: #333;
}

.my-picks ul {
  margin: 0.4rem 0 0 0;
  padding-left: 18px;
  list-style: disc;
  font-weight: 400;
  max-height: 200px;
  overflow-y: auto;
}

.my-picks ul li {
  margin-bottom: 4px;
  font-size: 0.95rem;
  color: #444;
}

/* Responsive improvements */
@media (max-width: 800px) {
  .controls {
    flex-direction: column;
    gap: 1rem;
  }
  .controls > * {
    flex-grow: 1;
    min-width: 100%;
  }
  table {
    font-size: 14px;
  }
  input[type="checkbox"] {
    width: 28px;
    height: 28px;
  }
}

/* Smooth transitions */
button,
input[type="text"],
select,
input[type="file"],
tbody tr {
  transition: all 0.3s ease;
}
.team-section {
  display: flex;
  flex-wrap: wrap;
  gap: 2rem;
  align-items: flex-start;
}

.team-names {
  flex: 2;
  min-width: 250px;
}

.team-config {
  flex: 1;
  min-width: 250px;
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

#teamNames input {
  margin-bottom: 0.5rem;
}
@media (max-width: 600px) {
  .team-section {
    flex-direction: column;
  }
}
@media (max-width: 600px) {
  .pick-number-box {
    display: block;
    margin-left: 0;
    margin-top: 6px;
  }
.pick-number-box {
  text-decoration: none !important;
}

}
.pick-number-box {
  text-decoration: none !important;
  opacity: 1 !important;
}
    @media (max-width: 600px) {
  body {
    padding: 1rem;
  }

  /* Center the table */
  table {
    margin: 0 auto;
    width: 100% !important;
    table-layout: fixed; /* Fix column widths */
    font-size: 14px;
  }

  /* Prevent wide columns, allow wrapping */
  th, td {
    padding: 8px 10px;
    word-wrap: break-word;
    white-space: normal; /* allow wrapping */
  }

  /* Limit Drafted By column width and allow wrapping */
  th:nth-child(6),
  td:nth-child(6) {
    max-width: 120px;
  }

  /* Optionally, hide Tag column (since you wanted to remove it) */
  th:nth-child(4),
  td:nth-child(4) {
    display: none;
  }
}

  </style>
</head>
<body>

<h2>Fantasy Draft Board</h2>

<div class="controls">
  <input type="file" id="fileInput" accept=".txt" />
  <button id="submitFileBtn">Submit File</button>
  <button id="removeFileBtn" disabled>Remove File</button>
  <input type="text" id="searchInput" placeholder="Search players..." />
  <button onclick="filterByPosition('ALL')">ALL</button>
  <button onclick="filterByPosition('RB')">RB</button>
  <button onclick="filterByPosition('WR')">WR</button>
  <button onclick="filterByPosition('QB')">QB</button>
  <button onclick="filterByPosition('TE')">TE</button>
  <label><input type="checkbox" id="hidePickedCheckbox" onchange="renderTable()" /> Hide Picked</label>
  <button onclick="resetAll()">Reset All</button>
</div>

<div class="controls team-section">
  <div class="team-names">
    <label>Number of Teams:
      <select id="teamCount"></select>
    </label>
    <div id="teamNames"></div>
  </div>
  <div class="team-config">
    <label>Choose Your Team:
      <select id="yourTeamSelect"></select>
    </label>
    <label>Your Team Pick Number:
      <select id="myPickIndex" disabled></select>
    </label>
    <button id="startDraftBtn" onclick="setupDraft()" disabled>Start Draft</button>
    <div id="currentPickDisplay" style="margin-top: 0.5rem;"></div>
  </div>
</div>

<h3>Your Picks</h3>
<div class="my-picks">
  <div><strong>QB</strong><ul id="myQB"></ul></div>
  <div><strong>RB</strong><ul id="myRB"></ul></div>
  <div><strong>WR</strong><ul id="myWR"></ul></div>
  <div><strong>TE</strong><ul id="myTE"></ul></div>
</div>

<table id="playerTable">
  <thead>
    <tr>
      <th>âœ”</th>
      <th>#</th>
      <th>Name</th>
      <th>Position</th>
      <th>Drafted By</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
  let players = [];
  let currentFilter = "ALL";
  let draftOrder = [];
  let currentPick = 0;
  let teamNames = [];
  let myTeamIndex = -1;

  // === Sync snippet added here ===
  // Auto-sync with picks from ESPN draft (via localStorage)
  let lastPickCount = 0;

  setInterval(() => {
    const synced = JSON.parse(localStorage.getItem("syncedPicks") || "[]");
    if (synced.length > lastPickCount) {
      const newPicks = synced.slice(lastPickCount);
      newPicks.forEach(({ name }) => {
        const player = players.find(p =>
          p.name.toLowerCase().includes(name.toLowerCase())
        );
        if (player && !player.drafted) {
          toggleDrafted(player.id);
        }
      });
      lastPickCount = synced.length;
    }
  }, 1000);
  // === End snippet ===

  const fileInput = document.getElementById("fileInput");
  const submitFileBtn = document.getElementById("submitFileBtn");
  const removeFileBtn = document.getElementById("removeFileBtn");
  const searchInput = document.getElementById("searchInput");
  const tableBody = document.querySelector("#playerTable tbody");
  const teamCountSelect = document.getElementById("teamCount");
  const yourTeamSelect = document.getElementById("yourTeamSelect");
  const myPickSelect = document.getElementById("myPickIndex");
  const startDraftBtn = document.getElementById("startDraftBtn");
  const currentPickDisplay = document.getElementById("currentPickDisplay");
  const teamNamesContainer = document.getElementById("teamNames");

  function populateTeamCountOptions() {
    const options = [10, 8, 12, 14];
    teamCountSelect.innerHTML = "";
    options.forEach(num => {
      const option = document.createElement("option");
      option.value = num;
      option.textContent = num;
      teamCountSelect.appendChild(option);
    });
  }

  function generateTeamNameInputs() {
    const teamCount = parseInt(teamCountSelect.value, 10);
    teamNamesContainer.innerHTML = "";
    for (let i = 0; i < teamCount; i++) {
      const input = document.createElement("input");
      input.type = "text";
      input.id = `teamName${i}`;
      input.placeholder = `Team ${i + 1}`;
      input.value = teamNames[i] || "";
      input.addEventListener("input", () => {
        teamNames[i] = input.value.trim();
        syncYourTeamSelectOptions();
        saveAll();
        validateStartDraftButton();
      });
      teamNamesContainer.appendChild(input);
      teamNamesContainer.appendChild(document.createElement("br"));
    }
  }

  function syncYourTeamSelectOptions() {
    const prevValue = yourTeamSelect.value;
    yourTeamSelect.innerHTML = '<option value="" disabled selected>-- Select Team --</option>';
    teamNames = teamNames.map(name => name.trim());
    const teamCount = parseInt(teamCountSelect.value, 10);

    for (let i = 0; i < teamCount; i++) {
      const name = teamNames[i] || "";
      if (name) {
        const option = document.createElement("option");
        option.value = i;
        option.textContent = name;
        yourTeamSelect.appendChild(option);
      }
    }

    if (!yourTeamSelect.querySelector(`option[value="${prevValue}"]`)) {
      yourTeamSelect.value = "";
      myTeamIndex = -1;
      myPickSelect.innerHTML = "";
      myPickSelect.disabled = true;
    } else {
      yourTeamSelect.value = prevValue;
      if (prevValue !== "") {
        myTeamIndex = parseInt(prevValue, 10);
        myPickSelect.innerHTML = "";
        const option = document.createElement("option");
        option.value = myTeamIndex + 1;
        option.textContent = myTeamIndex + 1;
        myPickSelect.appendChild(option);
        myPickSelect.value = option.value;
        myPickSelect.disabled = true;
      }
    }
  }

  yourTeamSelect.addEventListener("change", () => {
    const val = yourTeamSelect.value;
    if (val === "") {
      myTeamIndex = -1;
      myPickSelect.innerHTML = "";
      myPickSelect.disabled = true;
    } else {
      myTeamIndex = parseInt(val, 10);
      myPickSelect.innerHTML = "";
      const option = document.createElement("option");
      option.value = myTeamIndex + 1;
      option.textContent = myTeamIndex + 1;
      myPickSelect.appendChild(option);
      myPickSelect.value = option.value;
      myPickSelect.disabled = true;
    }
    saveAll();
    renderTable();
    validateStartDraftButton();
  });

  teamCountSelect.addEventListener("change", () => {
    saveAll();
    generateTeamNameInputs();
    syncYourTeamSelectOptions();
    validateStartDraftButton();
  });

  // Validate if draft can start (all teams named, your team selected, file submitted)
  function validateStartDraftButton() {
    let valid = true;

    // Clear all previous errors first
    fileInput.classList.remove("error");
    submitFileBtn.classList.remove("error");
    startDraftBtn.classList.remove("error");
    yourTeamSelect.classList.remove("error");

    // Validate team names: all must be non-empty
    const teamCount = parseInt(teamCountSelect.value, 10);
    let teamsValid = true;
    for (let i = 0; i < teamCount; i++) {
      const input = document.getElementById(`teamName${i}`);
      if (!input || input.value.trim() === "") {
        input?.classList.add("error");
        teamsValid = false;
        valid = false;
      } else {
        input.classList.remove("error");
      }
    }

    if (!teamsValid) valid = false;

    // Validate your team selected
    if (yourTeamSelect.value === "" || yourTeamSelect.value === null) {
      yourTeamSelect.classList.add("error");
      valid = false;
    } else {
      yourTeamSelect.classList.remove("error");
    }

    // Validate file loaded (players array non-empty)
    if (players.length === 0) {
      fileInput.classList.add("error");
      submitFileBtn.classList.add("error");
      valid = false;
    } else {
      fileInput.classList.remove("error");
      submitFileBtn.classList.remove("error");
    }

    startDraftBtn.disabled = !valid;
    if (!valid) startDraftBtn.classList.add("error");
    else startDraftBtn.classList.remove("error");
  }

  function saveAll() {
    localStorage.setItem("teamNames", JSON.stringify(teamNames));
    localStorage.setItem("myTeamIndex", myTeamIndex);
    localStorage.setItem("draftOrder", JSON.stringify(draftOrder));
    localStorage.setItem("players", JSON.stringify(players));
  }

  function loadAll() {
    const storedTeams = JSON.parse(localStorage.getItem("teamNames") || "[]");
    if (storedTeams.length) {
      teamNames = storedTeams;
    }
    const storedMyTeamIndex = localStorage.getItem("myTeamIndex");
    if (storedMyTeamIndex !== null) {
      myTeamIndex = parseInt(storedMyTeamIndex, 10);
    }
    const storedDraftOrder = JSON.parse(localStorage.getItem("draftOrder") || "[]");
    if (storedDraftOrder.length) {
      draftOrder = storedDraftOrder;
    }
    const storedPlayers = JSON.parse(localStorage.getItem("players") || "[]");
    if (storedPlayers.length) {
      players = storedPlayers;
    }
  }

  function renderTable() {
    tableBody.innerHTML = "";
    const hidePicked = document.getElementById("hidePickedCheckbox").checked;
    const search = searchInput.value.toLowerCase();

    let filtered = players.filter(p => {
      if (currentFilter !== "ALL" && p.position !== currentFilter) return false;
      if (hidePicked && p.drafted) return false;
      if (!p.name.toLowerCase().includes(search)) return false;
      return true;
    });

    filtered.forEach((p, i) => {
      const tr = document.createElement("tr");

      if (p.drafted) {
        tr.classList.add("strikethrough");
      }

      if (p.draftedBy === teamNames[myTeamIndex]) {
        tr.classList.add("highlight");
      }

      const draftedCheckboxTd = document.createElement("td");
      const draftedCheckbox = document.createElement("input");
      draftedCheckbox.type = "checkbox";
      draftedCheckbox.checked = p.drafted;
      draftedCheckbox.addEventListener("change", () => {
        toggleDrafted(p.id);
      });
      draftedCheckboxTd.appendChild(draftedCheckbox);
      tr.appendChild(draftedCheckboxTd);

      const pickNumberTd = document.createElement("td");
      pickNumberTd.textContent = p.pickNumber !== null ? p.pickNumber : "";
      tr.appendChild(pickNumberTd);

      const nameTd = document.createElement("td");
      nameTd.textContent = p.name;
      tr.appendChild(nameTd);

      const posTd = document.createElement("td");
      posTd.textContent = p.position;
      posTd.className = p.position;
      tr.appendChild(posTd);

      const draftedByTd = document.createElement("td");
      draftedByTd.textContent = p.draftedBy || "";
      tr.appendChild(draftedByTd);

      tableBody.appendChild(tr);
    });
  }

  function filterByPosition(pos) {
    currentFilter = pos;
    renderTable();
  }

  function toggleDrafted(id) {
    const player = players.find(p => p.id === id);
    if (!player) return;

    if (player.drafted) {
      player.drafted = false;
      player.draftedBy = null;
      player.pickNumber = null;
      currentPick = Math.max(0, currentPick - 1);
    } else {
      player.drafted = true;
      if (myTeamIndex >= 0 && teamNames[myTeamIndex]) {
        player.draftedBy = teamNames[myTeamIndex];
      } else {
        player.draftedBy = null;
      }
      currentPick++;
      player.pickNumber = currentPick;
    }
    saveAll();
    renderTable();
    renderMyPicks();
  }

  function renderMyPicks() {
    const qbList = document.getElementById("myQB");
    const rbList = document.getElementById("myRB");
    const wrList = document.getElementById("myWR");
    const teList = document.getElementById("myTE");
    qbList.innerHTML = "";
    rbList.innerHTML = "";
    wrList.innerHTML = "";
    teList.innerHTML = "";

    players.forEach(p => {
      if (p.draftedBy === teamNames[myTeamIndex]) {
        const li = document.createElement("li");
        li.textContent = `${p.name} (#${p.pickNumber})`;
        switch (p.position) {
          case "QB": qbList.appendChild(li); break;
          case "RB": rbList.appendChild(li); break;
          case "WR": wrList.appendChild(li); break;
          case "TE": teList.appendChild(li); break;
        }
      }
    });
  }

  submitFileBtn.addEventListener("click", () => {
    if (!fileInput.files.length) {
      alert("Please choose a player file first.");
      return;
    }
    const file = fileInput.files[0];
    const reader = new FileReader();
    reader.onload = (e) => {
      const text = e.target.result;
      parsePlayerFile(text);
      renderTable();
      saveAll();
      validateStartDraftButton();
      removeFileBtn.disabled = false;
      submitFileBtn.disabled = true;
    };
    reader.readAsText(file);
  });

  removeFileBtn.addEventListener("click", () => {
    players = [];
    renderTable();
    saveAll();
    removeFileBtn.disabled = true;
    submitFileBtn.disabled = false;
    validateStartDraftButton();
  });

  function parsePlayerFile(text) {
    players = [];
    const lines = text.split("\n");
    let id = 0;
    for (const line of lines) {
      if (!line.trim()) continue;
      const parts = line.split(",");
      if (parts.length < 3) continue;
      let [name, tag, position] = parts;
      name = name.trim();
      tag = tag.trim();
      position = position.trim().toUpperCase();
      if (!["QB", "RB", "WR", "TE"].includes(position)) continue;

      players.push({
        id: id++,
        name,
        tag,
        position,
        drafted: false,
        draftedBy: null,
        pickNumber: null,
      });
    }
  }

  searchInput.addEventListener("input", () => {
    renderTable();
  });

  document.getElementById("hidePickedCheckbox").addEventListener("change", () => {
    renderTable();
  });

  function setupDraft() {
    if (players.length === 0) {
      alert("Load a player file before starting draft.");
      return;
    }
    if (teamNames.length === 0 || teamNames.some(t => !t)) {
      alert("Fill out all team names before starting draft.");
      return;
    }
    if (myTeamIndex < 0) {
      alert("Select your team before starting draft.");
      return;
    }
    draftOrder = [...Array(teamNames.length).keys()];
    currentPick = 0;
    startDraftBtn.disabled = true;
    currentPickDisplay.textContent = `Current Pick: ${draftOrder[currentPick % draftOrder.length] + 1} (${teamNames[draftOrder[currentPick % draftOrder.length]]})`;
  }

  function resetAll() {
    if (!confirm("Are you sure you want to reset everything?")) return;
    players = [];
    teamNames = [];
    currentFilter = "ALL";
    draftOrder = [];
    currentPick = 0;
    myTeamIndex = -1;
    renderTable();
    generateTeamNameInputs();
    syncYourTeamSelectOptions();
    saveAll();
    validateStartDraftButton();
  }

  function init() {
    populateTeamCountOptions();
    loadAll();
    generateTeamNameInputs();
    syncYourTeamSelectOptions();
    renderTable();
    renderMyPicks();
    validateStartDraftButton();
    removeFileBtn.disabled = players.length === 0;
    submitFileBtn.disabled = players.length > 0;
  }

  init();
</script>

</body>
</html>
