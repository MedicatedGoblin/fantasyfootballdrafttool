<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Fantasy Draft Tool</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');

body {
  font-family: 'Inter', sans-serif;
  background: #f5f7fa;
  color: #222;
  padding: 2rem;
  max-width: 1200px;
  margin: auto;
  -webkit-user-select:none;
  -moz-user-select:none;
  -ms-user-select:none;
  user-select:none;
}

h2, h3 {
  font-weight: 600;
  color: #333;
  margin-bottom: 1rem;
}

.controls {
  margin-bottom: 1.5rem;
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  align-items: center;
}

.controls > * {
  flex-grow: 1;
  min-width: 120px;
}

input[type="file"] {
  border: 2px solid #ddd;
  padding: 0.4rem;
  border-radius: 6px;
  cursor: pointer;
  transition: border-color 0.3s ease;
}
input[type="file"]:hover,
input[type="file"]:focus {
  border-color: #007bff;
}

button {
  background-color: #007bff;
  border: none;
  color: white;
  padding: 0.6rem 1.2rem;
  font-weight: 600;
  border-radius: 6px;
  cursor: pointer;
  box-shadow: 0 3px 8px rgb(0 123 255 / 0.3);
  transition: background-color 0.3s ease, box-shadow 0.3s ease;
}
button:hover:not(:disabled) {
  background-color: #0056b3;
  box-shadow: 0 5px 12px rgb(0 86 179 / 0.5);
}
button:disabled {
  background-color: #a3c3f7;
  cursor: not-allowed;
  box-shadow: none;
}

input[type="text"],
select,
#searchInput {
  padding: 0.6rem 0.8rem;
  border-radius: 6px;
  border: 1.8px solid #ccc;
  transition: border-color 0.3s ease, box-shadow 0.3s ease;
  font-size: 1rem;
  min-width: 160px;
}
input[type="text"]:focus,
select:focus,
#searchInput:focus {
  border-color: #007bff;
  box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
  outline: none;
}

/* Error highlight */
.error {
  border-color: #e74c3c !important;
  background-color: #ffe6e6 !important;
  box-shadow: 0 0 8px rgba(231, 76, 60, 0.6);
}

/* Table Styling */
table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0 8px;
  background: white;
  box-shadow: 0 4px 12px rgb(0 0 0 / 0.1);
  border-radius: 8px;
  overflow: hidden;
  -webkit-user-select:none;
  -moz-user-select:none;
  -ms-user-select:none;
  user-select:none;
}

thead tr {
  background-color: #007bff;
  color: white;
  font-weight: 600;
}

th, td {
  padding: 12px 15px;
  text-align: left;
}

tbody tr {
  background-color: #fefefe;
  border-radius: 6px;
  transition: background-color 0.3s ease;
  cursor: pointer;
  box-shadow: 0 2px 4px rgb(0 0 0 / 0.04);
  user-select:none;
}

tbody tr:hover {
  background-color: #e9f1ff;
}

tbody tr.strikethrough {
  color: #aaa;
  text-decoration: line-through;
  opacity: 0.6;
  cursor: default;
}

tbody tr.highlight {
  background-color: #ffeb3b !important; /* Bright solid yellow */
  color: #000; /* Pure black text for max contrast */
  font-weight: 900;
  border-left: 8px solid #fdd835; /* Strong gold accent */
  text-shadow: none;
  box-shadow: 0 0 0 3px #fbc02d; /* Solid bold outline */
  transform: scale(1.01);
}
tbody tr.highlight:hover {
  transform: scale(1.01);
  box-shadow: 0 0 18px rgba(255, 213, 0, 0.9);
}

tbody tr.recent-pick {
  border: 3px solid #ff8c00;
  background-color: #fff8e1 !important;
  font-weight: 700;
}

th:nth-child(1),
td:nth-child(1) {
  text-align: center;
  width: 40px;
}

input[type="checkbox"] {
  width: 22px;
  height: 22px;
  cursor: pointer;
  transition: transform 0.2s ease;
}

input[type="checkbox"]:hover {
  transform: scale(1.2);
}

/* Position colors */
.RB {
  background-color: #b2d8b2 !important;
  color: #1b4d1b;
  font-weight: 600;
}
.WR {
  background-color: #a8cce6 !important;
  color: #12375a;
  font-weight: 600;
}
.QB {
  background-color: #f6d9a5 !important;
  color: #6b5200;
  font-weight: 600;
}
.TE {
  background-color: #d4b3f7 !important;
  color: #431a85;
  font-weight: 600;
}

/* Buttons and Inputs Group */
#teamNames input {
  width: 100%;
  margin-bottom: 0.7rem;
  font-size: 1rem;
}

/* Pick number box */
.pick-number-box {
  display: inline-block;
  background: #ff8c00;
  color: black;
  font-weight: bold;
  padding: 2px 8px;
  border-radius: 4px;
  font-size: 0.75rem;
  margin-left: 8px;
  margin-top: 4px;
  vertical-align: middle;
  box-shadow: 0 2px 5px rgba(255, 140, 0, 0.5);
  border: 2px solid #ff8c00;
  white-space: nowrap;
  text-decoration: none !important;
  opacity: 1 !important;
}

/* My picks styling */
.my-picks div {
  background: white;
  box-shadow: 0 2px 8px rgb(0 0 0 / 0.1);
  border-radius: 8px;
  padding: 10px 12px;
  min-width: 140px;
  max-width: 200px;
  font-weight: 600;
  color: #333;
}

.my-picks ul {
  margin: 0.4rem 0 0 0;
  padding-left: 18px;
  list-style: disc;
  font-weight: 400;
  max-height: 200px;
  overflow-y: auto;
}

.my-picks ul li {
  margin-bottom: 4px;
  font-size: 0.95rem;
  color: #444;
}

/* Responsive improvements */
@media (max-width: 800px) {
  .controls {
    flex-direction: column;
    gap: 1rem;
  }
  .controls > * {
    flex-grow: 1;
    min-width: 100%;
  }
  table {
    font-size: 14px;
  }
  input[type="checkbox"] {
    width: 28px;
    height: 28px;
  }
}

/* Smooth transitions */
button,
input[type="text"],
select,
input[type="file"],
tbody tr {
  transition: all 0.3s ease;
}
.team-section {
  display: flex;
  flex-wrap: wrap;
  gap: 2rem;
  align-items: flex-start;
}

.team-names {
  flex: 2;
  min-width: 250px;
}

.team-config {
  flex: 1;
  min-width: 250px;
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

#teamNames input {
  margin-bottom: 0.5rem;
}
@media (max-width: 600px) {
  .team-section {
    flex-direction: column;
  }
}
@media (max-width: 600px) {
  .pick-number-box {
    display: block;
    margin-left: 0;
    margin-top: 6px;
  }
}
@media (max-width: 600px) {
  body {
    padding: 1rem;
  }

  /* Center the table */
  table {
    margin: 0 auto;
    width: 100% !important;
    table-layout: fixed; /* Fix column widths */
    font-size: 14px;
  }

  /* Prevent wide columns, allow wrapping */
  th, td {
    padding: 8px 10px;
    word-wrap: break-word;
    white-space: normal; /* allow wrapping */
  }

  /* Limit Drafted By column width and allow wrapping */
  th:nth-child(5),
  td:nth-child(5) {
    max-width: 120px;
  }

  /* Optionally, hide Tag column if you want */
  /* If your current table doesn't have Tag column, skip this */
  /*
  th:nth-child(4),
  td:nth-child(4) {
    display: none;
  }
  */
}

/* Disable mobile double tap zoom */
html, body {
  touch-action: manipulation;
}
</style>
</head>
<body>

<h2>Fantasy Draft Board</h2>

<div class="controls">
  <input type="file" id="fileInput" accept=".txt" />
  <button id="submitFileBtn">Submit File</button>
  <button id="removeFileBtn" disabled>Remove File</button>
  <input type="text" id="searchInput" placeholder="Search players..." />
  <button onclick="filterByPosition('ALL')">ALL</button>
  <button onclick="filterByPosition('RB')">RB</button>
  <button onclick="filterByPosition('WR')">WR</button>
  <button onclick="filterByPosition('QB')">QB</button>
  <button onclick="filterByPosition('TE')">TE</button>
  <label><input type="checkbox" id="hidePickedCheckbox" onchange="renderTable()" /> Hide Picked</label>
  <button onclick="resetAll()">Reset All</button>
</div>

<div class="controls team-section">
  <div class="team-names">
    <label>Number of Teams:
      <select id="teamCount"></select>
    </label>
    <div id="teamNames"></div>
  </div>
  <div class="team-config">
    <label>Choose Your Team:
      <select id="yourTeamSelect"></select>
    </label>
    <label>Your Team Pick Number:
      <select id="myPickIndex" disabled></select>
    </label>
    <button id="startDraftBtn" onclick="setupDraft()" disabled>Start Draft</button>
    <div id="currentPickDisplay" style="margin-top: 0.5rem;"></div>
  </div>
</div>

<h3>Your Picks</h3>
<div class="my-picks">
  <div><strong>QB</strong><ul id="myQB"></ul></div>
  <div><strong>RB</strong><ul id="myRB"></ul></div>
  <div><strong>WR</strong><ul id="myWR"></ul></div>
  <div><strong>TE</strong><ul id="myTE"></ul></div>
</div>

<table id="playerTable">
  <thead>
    <tr>
      <th>âœ”</th>
      <th>#</th>
      <th>Name</th>
      <th>Position</th>
      <th>Drafted By</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
  let players = [];
  let currentFilter = "ALL";
  let draftOrder = [];
  let currentPick = 0;
  let teamNames = [];
  let myTeamIndex = -1;

  // === Sync snippet for ESPN draft picks via localStorage ===
  let lastPickCount = 0;
  setInterval(() => {
    const synced = JSON.parse(localStorage.getItem("syncedPicks") || "[]");
    if (synced.length > lastPickCount) {
      const newPicks = synced.slice(lastPickCount);
      newPicks.forEach(({ name }) => {
        const player = players.find(p =>
          p.name.toLowerCase().includes(name.toLowerCase())
        );
        if (player && !player.drafted) {
          toggleDrafted(player.id);
        }
      });
      lastPickCount = synced.length;
    }
  }, 1000);
  // === End sync snippet ===

  const fileInput = document.getElementById("fileInput");
  const submitFileBtn = document.getElementById("submitFileBtn");
  const removeFileBtn = document.getElementById("removeFileBtn");
  const searchInput = document.getElementById("searchInput");
  const tableBody = document.querySelector("#playerTable tbody");
  const teamCountSelect = document.getElementById("teamCount");
  const yourTeamSelect = document.getElementById("yourTeamSelect");
  const myPickSelect = document.getElementById("myPickIndex");
  const startDraftBtn = document.getElementById("startDraftBtn");
  const currentPickDisplay = document.getElementById("currentPickDisplay");
  const teamNamesContainer = document.getElementById("teamNames");

  function populateTeamCountOptions() {
    const options = [10, 8, 12, 14];
    teamCountSelect.innerHTML = "";
    options.forEach(num => {
      const option = document.createElement("option");
      option.value = num;
      option.textContent = num;
      teamCountSelect.appendChild(option);
    });
  }

  function generateTeamNameInputs() {
    const teamCount = parseInt(teamCountSelect.value, 10);
    teamNamesContainer.innerHTML = "";
    for (let i = 0; i < teamCount; i++) {
      const input = document.createElement("input");
      input.type = "text";
      input.id = `teamName${i}`;
      input.placeholder = `Team ${i + 1}`;
      input.value = teamNames[i] || "";
      input.addEventListener("input", () => {
        teamNames[i] = input.value.trim();
        syncYourTeamSelectOptions();
        saveAll();
        validateStartDraftButton();
      });
      teamNamesContainer.appendChild(input);
      teamNamesContainer.appendChild(document.createElement("br"));
    }
  }

  function syncYourTeamSelectOptions() {
    const prevValue = yourTeamSelect.value;
    yourTeamSelect.innerHTML = '<option value="" disabled selected>-- Select Team --</option>';
    teamNames = teamNames.map(name => name.trim());
    const teamCount = parseInt(teamCountSelect.value, 10);

    for (let i = 0; i < teamCount; i++) {
      const name = teamNames[i] || "";
      if (name) {
        const option = document.createElement("option");
        option.value = i;
        option.textContent = name;
        yourTeamSelect.appendChild(option);
      }
    }

    if (!yourTeamSelect.querySelector(`option[value="${prevValue}"]`)) {
      yourTeamSelect.value = "";
      myTeamIndex = -1;
      myPickSelect.innerHTML = "";
      myPickSelect.disabled = true;
    } else {
      yourTeamSelect.value = prevValue;
      if (prevValue !== "") {
        myTeamIndex = parseInt(prevValue, 10);
        myPickSelect.innerHTML = "";
        const option = document.createElement("option");
        option.value = myTeamIndex + 1;
        option.textContent = myTeamIndex + 1;
        myPickSelect.appendChild(option);
        myPickSelect.value = option.value;
        myPickSelect.disabled = true;
      }
    }
  }

  yourTeamSelect.addEventListener("change", () => {
    const val = yourTeamSelect.value;
    if (val === "") {
      myTeamIndex = -1;
      myPickSelect.innerHTML = "";
      myPickSelect.disabled = true;
    } else {
      myTeamIndex = parseInt(val, 10);
      myPickSelect.innerHTML = "";
      const option = document.createElement("option");
      option.value = myTeamIndex + 1;
      option.textContent = myTeamIndex + 1;
      myPickSelect.appendChild(option);
      myPickSelect.value = option.value;
      myPickSelect.disabled = true;
    }
    saveAll();
    renderTable();
    validateStartDraftButton();
  });

  teamCountSelect.addEventListener("change", () => {
    saveAll();
    generateTeamNameInputs();
    syncYourTeamSelectOptions();
    validateStartDraftButton();
  });

  // Validate if draft can start (all teams named, your team selected, file submitted)
  function validateStartDraftButton() {
    let valid = true;

    // Clear all previous errors first
    fileInput.classList.remove("error");
    submitFileBtn.classList.remove("error");
    startDraftBtn.classList.remove("error");
    yourTeamSelect.classList.remove("error");

    // Validate team names: all must be non-empty
    const teamCount = parseInt(teamCountSelect.value, 10);
    let teamsValid = true;
    for (let i = 0; i < teamCount; i++) {
      const input = document.getElementById(`teamName${i}`);
      if (!input || input.value.trim() === "") {
        teamsValid = false;
        input?.classList.add("error");
      } else {
        input?.classList.remove("error");
      }
    }
    if (!teamsValid) valid = false;

    // Validate your team selected
    if (myTeamIndex === -1) {
      yourTeamSelect.classList.add("error");
      valid = false;
    }

    // Validate file loaded
    if (players.length === 0) {
      fileInput.classList.add("error");
      submitFileBtn.classList.add("error");
      valid = false;
    }

    startDraftBtn.disabled = !valid;
  }

  // Save team names and selection to localStorage
  function saveAll() {
    const teamCount = parseInt(teamCountSelect.value, 10);
    let teams = [];
    for (let i = 0; i < teamCount; i++) {
      const input = document.getElementById(`teamName${i}`);
      teams.push(input?.value.trim() || "");
    }
    localStorage.setItem("teamNames", JSON.stringify(teams));
    localStorage.setItem("teamCount", teamCount);
    localStorage.setItem("yourTeamIndex", myTeamIndex);
  }

  function loadAll() {
    const savedTeamCount = parseInt(localStorage.getItem("teamCount"), 10);
    if (savedTeamCount && [8,10,12,14].includes(savedTeamCount)) {
      teamCountSelect.value = savedTeamCount;
    } else {
      teamCountSelect.value = 10;
    }
    teamNames = JSON.parse(localStorage.getItem("teamNames") || "[]");
    generateTeamNameInputs();
    syncYourTeamSelectOptions();

    const savedYourTeamIndex = parseInt(localStorage.getItem("yourTeamIndex"), 10);
    if (!isNaN(savedYourTeamIndex) && savedYourTeamIndex >= 0) {
      yourTeamSelect.value = savedYourTeamIndex;
      myTeamIndex = savedYourTeamIndex;
      myPickSelect.innerHTML = "";
      const option = document.createElement("option");
      option.value = myTeamIndex + 1;
      option.textContent = myTeamIndex + 1;
      myPickSelect.appendChild(option);
      myPickSelect.value = option.value;
      myPickSelect.disabled = true;
    }
  }

  // Load file, parse players, store in players array
  submitFileBtn.addEventListener("click", () => {
    if (!fileInput.files.length) {
      alert("Please select a file to upload first.");
      fileInput.classList.add("error");
      return;
    }
    fileInput.classList.remove("error");
    const file = fileInput.files[0];
    const reader = new FileReader();
    reader.onload = e => {
      parseFile(e.target.result);
      saveAll();
      validateStartDraftButton();
      renderTable();
      removeFileBtn.disabled = false;
    };
    reader.readAsText(file);
  });

  removeFileBtn.addEventListener("click", () => {
    players = [];
    fileInput.value = "";
    removeFileBtn.disabled = true;
    renderTable();
    validateStartDraftButton();
  });

  // Parses raw text file - expects lines like "PlayerName Position"
  function parseFile(text) {
    players = [];
    const lines = text.split(/\r?\n/).filter(Boolean);
    let idCounter = 1;
    for (const line of lines) {
      const parts = line.trim().split(/\s+/);
      if (parts.length < 2) continue;
      const position = parts.pop().toUpperCase();
      const name = parts.join(" ");
      if (!["QB","RB","WR","TE"].includes(position)) continue;
      players.push({
        id: idCounter++,
        name,
        position,
        drafted: false,
        draftedBy: "",
        pickNumber: 0
      });
    }
  }

  // Search filter on input
  searchInput.addEventListener("input", () => {
    renderTable();
  });

  function filterByPosition(pos) {
    currentFilter = pos;
    renderTable();
  }

  function toggleDrafted(id) {
    const player = players.find(p => p.id === id);
    if (!player) return;

    if (!player.drafted) {
      // Mark drafted
      if (currentPick >= teamNames.length) currentPick = 0;
      player.drafted = true;
      player.draftedBy = teamNames[currentPick] || "";
      player.pickNumber = currentPick + 1;

      currentPick++;
      if (currentPick >= teamNames.length) currentPick = 0;
    } else {
      // Undraft
      player.drafted = false;
      player.draftedBy = "";
      player.pickNumber = 0;
      currentPick = player.pickNumber - 1;
      if (currentPick < 0) currentPick = 0;
    }

    saveAll();
    renderTable();
  }

  // Reset all drafted status and picks
  function resetAll() {
    players.forEach(p => {
      p.drafted = false;
      p.draftedBy = "";
      p.pickNumber = 0;
    });
    currentPick = 0;
    saveAll();
    renderTable();
  }

  // Set up draft (can add more logic here if needed)
  function setupDraft() {
    alert("Draft started!");
    renderTable();
  }

  // Render the players table
  function renderTable() {
    const searchTerm = searchInput.value.toLowerCase();
    const hidePicked = document.getElementById("hidePickedCheckbox").checked;

    tableBody.innerHTML = "";

    let pickNumberGlobal = 1;

    // Sort players alphabetically by name
    let filtered = players.filter(player => {
      if (currentFilter !== "ALL" && player.position !== currentFilter) return false;
      if (hidePicked && player.drafted) return false;
      if (searchTerm && !player.name.toLowerCase().includes(searchTerm)) return false;
      return true;
    });

    // Sort drafted players last so undrafted appear on top
    filtered.sort((a, b) => {
      if (a.drafted === b.drafted) {
        return a.name.localeCompare(b.name);
      }
      return a.drafted ? 1 : -1;
    });

    for (const player of filtered) {
      const tr = document.createElement("tr");

      if (player.drafted && player.draftedBy === teamNames[myTeamIndex]) {
        tr.classList.add("highlight");
      }

      // Checkbox cell
      const checkTd = document.createElement("td");
      const checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      checkbox.checked = player.drafted;
      checkbox.addEventListener("click", e => {
        e.stopPropagation();
        toggleDrafted(player.id);
      });
      checkTd.appendChild(checkbox);
      tr.appendChild(checkTd);

      // Pick number cell
      const pickTd = document.createElement("td");
      if (player.drafted) {
        const pickBox = document.createElement("span");
        pickBox.className = "pick-number-box";
        pickBox.textContent = `Pick ${player.pickNumber}`;
        pickTd.appendChild(pickBox);
      } else {
        pickTd.textContent = "";
      }
      tr.appendChild(pickTd);

      // Name cell
      const nameTd = document.createElement("td");
      nameTd.textContent = player.name;
      tr.appendChild(nameTd);

      // Position cell
      const posTd = document.createElement("td");
      posTd.textContent = player.position;
      posTd.classList.add(player.position);
      tr.appendChild(posTd);

      // Drafted by cell
      const draftedByTd = document.createElement("td");
      draftedByTd.textContent = player.drafted ? player.draftedBy : "";
      tr.appendChild(draftedByTd);

      // Double click toggles drafted
      tr.addEventListener("dblclick", () => {
        toggleDrafted(player.id);
      });

      tableBody.appendChild(tr);
    }

    updateMyPicks();
  }

  function updateMyPicks() {
    const myQB = document.getElementById("myQB");
    const myRB = document.getElementById("myRB");
    const myWR = document.getElementById("myWR");
    const myTE = document.getElementById("myTE");

    myQB.innerHTML = "";
    myRB.innerHTML = "";
    myWR.innerHTML = "";
    myTE.innerHTML = "";

    if (myTeamIndex === -1) return;

    players.filter(p => p.drafted && p.draftedBy === teamNames[myTeamIndex]).forEach(p => {
      const li = document.createElement("li");
      li.textContent = p.name;
      if (p.position === "QB") myQB.appendChild(li);
      else if (p.position === "RB") myRB.appendChild(li);
      else if (p.position === "WR") myWR.appendChild(li);
      else if (p.position === "TE") myTE.appendChild(li);
    });
  }

  // Initialization
  function init() {
    populateTeamCountOptions();
    loadAll();
    generateTeamNameInputs();
    syncYourTeamSelectOptions();
    validateStartDraftButton();
    renderTable();
  }

  init();
</script>

</body>
</html>
