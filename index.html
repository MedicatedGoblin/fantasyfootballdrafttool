<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fantasy Draft Tool</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');

body {
  font-family: 'Inter', sans-serif;
  background: #f5f7fa;
  color: #222;
  padding: 2rem;
  max-width: 1200px;
  margin: auto;
}

h2, h3 {
  font-weight: 600;
  color: #333;
  margin-bottom: 1rem;
}

.controls {
  margin-bottom: 1.5rem;
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  align-items: center;
}

.controls > * {
  flex-grow: 1;
  min-width: 120px;
}

input[type="file"] {
  border: 2px solid #ddd;
  padding: 0.4rem;
  border-radius: 6px;
  cursor: pointer;
  transition: border-color 0.3s ease;
}
input[type="file"]:hover,
input[type="file"]:focus {
  border-color: #007bff;
}

button {
  background-color: #007bff;
  border: none;
  color: white;
  padding: 0.6rem 1.2rem;
  font-weight: 600;
  border-radius: 6px;
  cursor: pointer;
  box-shadow: 0 3px 8px rgb(0 123 255 / 0.3);
  transition: background-color 0.3s ease, box-shadow 0.3s ease;
}
button:hover:not(:disabled) {
  background-color: #0056b3;
  box-shadow: 0 5px 12px rgb(0 86 179 / 0.5);
}
button:disabled {
  background-color: #a3c3f7;
  cursor: not-allowed;
  box-shadow: none;
}

input[type="text"],
select,
#searchInput {
  padding: 0.6rem 0.8rem;
  border-radius: 6px;
  border: 1.8px solid #ccc;
  transition: border-color 0.3s ease, box-shadow 0.3s ease;
  font-size: 1rem;
  min-width: 160px;
}
input[type="text"]:focus,
select:focus,
#searchInput:focus {
  border-color: #007bff;
  box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
  outline: none;
}

/* Error highlight */
.error {
  border-color: #e74c3c !important;
  background-color: #ffe6e6 !important;
  box-shadow: 0 0 8px rgba(231, 76, 60, 0.6);
}

/* Table Styling */
table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0 8px;
  background: white;
  box-shadow: 0 4px 12px rgb(0 0 0 / 0.1);
  border-radius: 8px;
  overflow: hidden;
}

thead tr {
  background-color: #007bff;
  color: white;
  font-weight: 600;
}

th, td {
  padding: 12px 15px;
  text-align: left;
}

tbody tr {
  background-color: #fefefe;
  border-radius: 6px;
  transition: background-color 0.3s ease;
  cursor: pointer;
  box-shadow: 0 2px 4px rgb(0 0 0 / 0.04);
}

tbody tr:hover {
  background-color: #e9f1ff;
}

tbody tr.strikethrough {
  color: #aaa;
  text-decoration: line-through;
  opacity: 0.6;
  cursor: default;
}

tbody tr.highlight {
  background-color: #fff59d !important; /* bright yellow background */
  color: #4a3900;
  font-weight: 800;
  border-left: 6px solid #fbc02d;
  box-shadow: inset 0 0 0 2px #fdd835, 0 0 10px rgba(255, 215, 0, 0.7);
  text-shadow: 0 0 1px #fff8dc;
}

tbody tr.recent-pick {
  border: 3px solid #ff8c00;
  background-color: #fff8e1 !important;
  font-weight: 700;
}

th:nth-child(1),
td:nth-child(1) {
  text-align: center;
  width: 40px;
}

input[type="checkbox"] {
  width: 22px;
  height: 22px;
  cursor: pointer;
  transition: transform 0.2s ease;
}

input[type="checkbox"]:hover {
  transform: scale(1.2);
}

/* Position colors */
.RB {
  background-color: #b2d8b2 !important;
  color: #1b4d1b;
  font-weight: 600;
}
.WR {
  background-color: #a8cce6 !important;
  color: #12375a;
  font-weight: 600;
}
.QB {
  background-color: #f6d9a5 !important;
  color: #6b5200;
  font-weight: 600;
}
.TE {
  background-color: #d4b3f7 !important;
  color: #431a85;
  font-weight: 600;
}

/* Buttons and Inputs Group */
#teamNames input {
  width: 100%;
  margin-bottom: 0.7rem;
  font-size: 1rem;
}

/* Pick number box */
.pick-number-box {
  display: inline-block;
  background: #ff8c00;
  color: black;
  font-weight: bold;
  padding: 2px 8px;
  border-radius: 4px;
  font-size: 0.75rem;
  margin-left: 8px;
  margin-top: 4px;
  vertical-align: middle;
  box-shadow: 0 2px 5px rgba(255, 140, 0, 0.5);
  border: 2px solid #ff8c00;
  white-space: nowrap;
}

/* My picks styling */
.my-picks div {
  background: white;
  box-shadow: 0 2px 8px rgb(0 0 0 / 0.1);
  border-radius: 8px;
  padding: 10px 12px;
  min-width: 140px;
  max-width: 200px;
  font-weight: 600;
  color: #333;
}

.my-picks ul {
  margin: 0.4rem 0 0 0;
  padding-left: 18px;
  list-style: disc;
  font-weight: 400;
  max-height: 200px;
  overflow-y: auto;
}

.my-picks ul li {
  margin-bottom: 4px;
  font-size: 0.95rem;
  color: #444;
}

/* Responsive improvements */
@media (max-width: 800px) {
  .controls {
    flex-direction: column;
    gap: 1rem;
  }
  .controls > * {
    flex-grow: 1;
    min-width: 100%;
  }
  table {
    font-size: 14px;
  }
  input[type="checkbox"] {
    width: 28px;
    height: 28px;
  }
}

/* Smooth transitions */
button,
input[type="text"],
select,
input[type="file"],
tbody tr {
  transition: all 0.3s ease;
}
.team-section {
  display: flex;
  flex-wrap: wrap;
  gap: 2rem;
  align-items: flex-start;
}

.team-names {
  flex: 2;
  min-width: 250px;
}

.team-config {
  flex: 1;
  min-width: 250px;
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

#teamNames input {
  margin-bottom: 0.5rem;
}
@media (max-width: 600px) {
  .team-section {
    flex-direction: column;
  }
}
@media (max-width: 600px) {
  .pick-number-box {
    display: block;
    margin-left: 0;
    margin-top: 6px;
  }
}
  </style>
</head>
<body>

<h2>Fantasy Draft Board</h2>

<div class="controls">
  <input type="file" id="fileInput" accept=".txt" />
  <button id="submitFileBtn">Submit File</button>
  <button id="removeFileBtn" disabled>Remove File</button>
  <input type="text" id="searchInput" placeholder="Search players..." />
  <button onclick="filterByPosition('ALL')">ALL</button>
  <button onclick="filterByPosition('RB')">RB</button>
  <button onclick="filterByPosition('WR')">WR</button>
  <button onclick="filterByPosition('QB')">QB</button>
  <button onclick="filterByPosition('TE')">TE</button>
  <label><input type="checkbox" id="hidePickedCheckbox" onchange="renderTable()" /> Hide Picked</label>
  <button onclick="resetAll()">Reset All</button>
</div>

<div class="controls team-section">
  <div class="team-names">
    <label>Number of Teams:
      <select id="teamCount"></select>
    </label>
    <div id="teamNames"></div>
  </div>
  <div class="team-config">
    <label>Choose Your Team:
      <select id="yourTeamSelect"></select>
    </label>
    <label>Your Team Pick Number:
      <select id="myPickIndex" disabled></select>
    </label>
    <button id="startDraftBtn" onclick="setupDraft()" disabled>Start Draft</button>
    <div id="currentPickDisplay" style="margin-top: 0.5rem;"></div>
  </div>
</div>

<h3>Your Picks</h3>
<div class="my-picks">
  <div><strong>QB</strong><ul id="myQB"></ul></div>
  <div><strong>RB</strong><ul id="myRB"></ul></div>
  <div><strong>WR</strong><ul id="myWR"></ul></div>
  <div><strong>TE</strong><ul id="myTE"></ul></div>
</div>

<table id="playerTable">
  <thead>
    <tr>
      <th>âœ”</th>
      <th>#</th>
      <th>Name</th>
      <th>Tag</th>
      <th>Position</th>
      <th>Drafted By</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
  let players = [];
  let currentFilter = "ALL";
  let draftOrder = [];
  let currentPick = 0;
  let teamNames = [];
  let myTeamIndex = -1;

  const fileInput = document.getElementById("fileInput");
  const submitFileBtn = document.getElementById("submitFileBtn");
  const removeFileBtn = document.getElementById("removeFileBtn");
  const searchInput = document.getElementById("searchInput");
  const tableBody = document.querySelector("#playerTable tbody");
  const teamCountSelect = document.getElementById("teamCount");
  const yourTeamSelect = document.getElementById("yourTeamSelect");
  const myPickSelect = document.getElementById("myPickIndex");
  const startDraftBtn = document.getElementById("startDraftBtn");
  const currentPickDisplay = document.getElementById("currentPickDisplay");
  const teamNamesContainer = document.getElementById("teamNames");

  function populateTeamCountOptions() {
    const options = [10, 8, 12, 14];
    teamCountSelect.innerHTML = "";
    options.forEach(num => {
      const option = document.createElement("option");
      option.value = num;
      option.textContent = num;
      teamCountSelect.appendChild(option);
    });
  }

  function generateTeamNameInputs() {
    const teamCount = parseInt(teamCountSelect.value, 10);
    teamNamesContainer.innerHTML = "";
    for (let i = 0; i < teamCount; i++) {
      const input = document.createElement("input");
      input.type = "text";
      input.id = `teamName${i}`;
      input.placeholder = `Team ${i + 1}`;
      input.value = teamNames[i] || "";
      input.addEventListener("input", () => {
        teamNames[i] = input.value.trim();
        syncYourTeamSelectOptions();
        saveAll();
        validateStartDraftButton();
      });
      teamNamesContainer.appendChild(input);
      teamNamesContainer.appendChild(document.createElement("br"));
    }
  }

  function syncYourTeamSelectOptions() {
    const prevValue = yourTeamSelect.value;
    yourTeamSelect.innerHTML = '<option value="" disabled selected>-- Select Team --</option>';
    teamNames = teamNames.map(name => name.trim());
    const teamCount = parseInt(teamCountSelect.value, 10);

    for (let i = 0; i < teamCount; i++) {
      const name = teamNames[i] || "";
      if (name) {
        const option = document.createElement("option");
        option.value = i;
        option.textContent = name;
        yourTeamSelect.appendChild(option);
      }
    }

    if (!yourTeamSelect.querySelector(`option[value="${prevValue}"]`)) {
      yourTeamSelect.value = "";
      myTeamIndex = -1;
      myPickSelect.innerHTML = "";
      myPickSelect.disabled = true;
    } else {
      yourTeamSelect.value = prevValue;
      if (prevValue !== "") {
        myTeamIndex = parseInt(prevValue, 10);
        myPickSelect.innerHTML = "";
        const option = document.createElement("option");
        option.value = myTeamIndex + 1;
        option.textContent = myTeamIndex + 1;
        myPickSelect.appendChild(option);
        myPickSelect.value = option.value;
        myPickSelect.disabled = true;
      }
    }
  }

  yourTeamSelect.addEventListener("change", () => {
    const val = yourTeamSelect.value;
    if (val === "") {
      myTeamIndex = -1;
      myPickSelect.innerHTML = "";
      myPickSelect.disabled = true;
    } else {
      myTeamIndex = parseInt(val, 10);
      myPickSelect.innerHTML = "";
      const option = document.createElement("option");
      option.value = myTeamIndex + 1;
      option.textContent = myTeamIndex + 1;
      myPickSelect.appendChild(option);
      myPickSelect.value = option.value;
      myPickSelect.disabled = true;
    }
    saveAll();
    renderTable();
    validateStartDraftButton();
  });

  teamCountSelect.addEventListener("change", () => {
    saveAll();
    generateTeamNameInputs();
    syncYourTeamSelectOptions();
    validateStartDraftButton();
  });

  // Validate if draft can start (all teams named, your team selected, file submitted)
  function validateStartDraftButton() {
    let valid = true;

    // Clear all previous errors first
    fileInput.classList.remove("error");
    submitFileBtn.classList.remove("error");
    startDraftBtn.classList.remove("error");
    yourTeamSelect.classList.remove("error");

    // Validate team names: all must be non-empty
    const teamCount = parseInt(teamCountSelect.value, 10);
    let teamsValid = true;
    for (let i = 0; i < teamCount; i++) {
      const input = document.getElementById(`teamName${i}`);
      if (!input || input.value.trim() === "") {
        input?.classList.add("error");
        teamsValid = false;
        valid = false;
      } else {
        input.classList.remove("error");
      }
    }

    if (!teamsValid) valid = false;

    // Validate your team selected
    if (yourTeamSelect.value === "" || yourTeamSelect.value === null) {
      yourTeamSelect.classList.add("error");
      valid = false;
    } else {
      yourTeamSelect.classList.remove("error");
    }

    // Validate player list loaded (file submitted)
    if (players.length === 0) {
      fileInput.classList.add("error");
      submitFileBtn.classList.add("error");
      valid = false;
    } else {
      fileInput.classList.remove("error");
      submitFileBtn.classList.remove("error");
    }

    startDraftBtn.disabled = !valid;
  }

  function setupDraft() {
    validateStartDraftButton();
    if (startDraftBtn.disabled) {
      alert("Please fix the highlighted errors before starting the draft.");
      return;
    }

    const namesSet = new Set();
    for (const name of teamNames) {
      if (!name) {
        alert("All teams must have a name.");
        return;
      }
      if (namesSet.has(name.toLowerCase())) {
        alert("Team names must be unique.");
        return;
      }
      namesSet.add(name.toLowerCase());
    }

    const teamCount = parseInt(teamCountSelect.value, 10);
    draftOrder = [];
    let forward = true;
    for (let round = 0; round < 20; round++) {
      const roundOrder = Array.from({ length: teamCount }, (_, i) => i);
      draftOrder.push(...(forward ? roundOrder : roundOrder.reverse()));
      forward = !forward;
    }

    if (currentPick >= draftOrder.length) currentPick = 0; // reset if draft finished previously

    updateCurrentPickDisplay();
    saveAll();
    renderTable();
  }

  function updateCurrentPickDisplay() {
    if (currentPick >= draftOrder.length) {
      currentPickDisplay.textContent = "Draft Complete!";
      startDraftBtn.disabled = true;
      return;
    }
    const teamIndex = draftOrder[currentPick];
    const teamName = teamNames[teamIndex] || "";
    currentPickDisplay.textContent = `Pick ${currentPick + 1} - ${teamName}`;
  }

  function toggleDrafted(id) {
    const player = players.find(p => p.id === id);
    if (!player) return;

    if (!player.drafted) {
      if (currentPick >= draftOrder.length) {
        alert("All picks completed!");
        return;
      }
      player.drafted = true;
      const teamIndex = draftOrder[currentPick];
      player.draftedBy = teamNames[teamIndex];
      player.pickNumber = currentPick + 1;
      currentPick++;
    } else {
      if (player.pickNumber === currentPick) {
        player.drafted = false;
        player.draftedBy = null;
        player.pickNumber = null;
        currentPick--;
      } else if (player.pickNumber < currentPick) {
        alert("You can only undo the most recent pick.");
        return;
      }
    }

    updateCurrentPickDisplay();
    saveAll();
    renderTable();
  }

  function saveAll() {
    localStorage.setItem("players", JSON.stringify(players));
    localStorage.setItem("teamNames", JSON.stringify(teamNames));
    localStorage.setItem("draftOrder", JSON.stringify(draftOrder));
    localStorage.setItem("currentPick", currentPick);
    localStorage.setItem("myTeamIndex", myTeamIndex);
    localStorage.setItem("teamCount", teamCountSelect.value);
    localStorage.setItem("yourTeamSelect", yourTeamSelect.value);
  }

  function loadAll() {
    const storedPlayers = localStorage.getItem("players");
    if (storedPlayers) players = JSON.parse(storedPlayers);

    const storedTeamNames = localStorage.getItem("teamNames");
    if (storedTeamNames) teamNames = JSON.parse(storedTeamNames);

    const storedDraftOrder = localStorage.getItem("draftOrder");
    if (storedDraftOrder) draftOrder = JSON.parse(storedDraftOrder);

    const storedCurrentPick = localStorage.getItem("currentPick");
    if (storedCurrentPick) currentPick = parseInt(storedCurrentPick, 10);

    const storedMyTeamIndex = localStorage.getItem("myTeamIndex");
    if (storedMyTeamIndex) myTeamIndex = parseInt(storedMyTeamIndex, 10);

    const storedTeamCount = localStorage.getItem("teamCount");
    if (storedTeamCount) teamCountSelect.value = storedTeamCount;
    else teamCountSelect.value = "10";

    generateTeamNameInputs();

    for (let i = 0; i < teamNames.length; i++) {
      const input = document.getElementById(`teamName${i}`);
      if (input) input.value = teamNames[i] || "";
    }

    syncYourTeamSelectOptions();

    if (myTeamIndex >= 0 && yourTeamSelect.querySelector(`option[value="${myTeamIndex}"]`)) {
      yourTeamSelect.value = myTeamIndex;
      myPickSelect.innerHTML = "";
      const option = document.createElement("option");
      option.value = myTeamIndex + 1;
      option.textContent = myTeamIndex + 1;
      myPickSelect.appendChild(option);
      myPickSelect.value = option.value;
      myPickSelect.disabled = true;
      startDraftBtn.disabled = false;
    } else {
      yourTeamSelect.value = "";
      myTeamIndex = -1;
      myPickSelect.innerHTML = "";
      myPickSelect.disabled = true;
      startDraftBtn.disabled = true;
    }
  }

  function filterByPosition(pos) {
    currentFilter = pos;
    renderTable();
  }

  function resetAll() {
    if (!confirm("Are you sure you want to reset everything?")) return;
    players = players.map(p => ({
      ...p,
      drafted: false,
      draftedBy: null,
      pickNumber: null,
    }));
    currentPick = 0;
    draftOrder = [];
    teamNames = [];
    myTeamIndex = -1;
    teamCountSelect.value = "10";
    yourTeamSelect.value = "";
    myPickSelect.innerHTML = "";
    myPickSelect.disabled = true;
    startDraftBtn.disabled = true;
    localStorage.clear();
    generateTeamNameInputs();
    renderTable();
    updateCurrentPickDisplay();
    clearFileInput();
  }

  function renderTable() {
    const keyword = searchInput.value.toLowerCase();
    const hidePicked = document.getElementById("hidePickedCheckbox").checked;
    tableBody.innerHTML = "";
    document.getElementById("myQB").innerHTML = "";
    document.getElementById("myRB").innerHTML = "";
    document.getElementById("myWR").innerHTML = "";
    document.getElementById("myTE").innerHTML = "";

    players.forEach(player => {
      const matchesFilter = currentFilter === "ALL" || player.position === currentFilter;
      const matchesSearch = player.name.toLowerCase().includes(keyword);
      if (!matchesFilter || !matchesSearch) return;

      if (!(hidePicked && player.drafted)) {
        const tr = document.createElement("tr");
        tr.classList.add(player.position);
        if (player.drafted) tr.classList.add("strikethrough");
        if (player.draftedBy === teamNames[myTeamIndex]) tr.classList.add("highlight");
        if (player.pickNumber === currentPick && player.draftedBy !== teamNames[myTeamIndex]) tr.classList.add("recent-pick");

        tr.addEventListener("dblclick", () => {
          toggleDrafted(player.id);
        });

        const nameCell = document.createElement("td");
        nameCell.textContent = player.name;
        if (tr.classList.contains("recent-pick")) {
          const pickNumberBox = document.createElement("span");
          pickNumberBox.className = "pick-number-box";
          pickNumberBox.textContent = `Pick ${player.pickNumber}`;
          nameCell.appendChild(pickNumberBox);

        }

        const cbCell = document.createElement("td");
        const cb = document.createElement("input");
        cb.type = "checkbox";
        cb.checked = player.drafted;
        cb.dataset.id = player.id;
        cb.addEventListener("change", () => {
          toggleDrafted(player.id);
        });
        cbCell.appendChild(cb);

        tr.appendChild(cbCell);

        const numCell = document.createElement("td");
        numCell.textContent = player.id;
        tr.appendChild(numCell);

        tr.appendChild(nameCell);

        const tagCell = document.createElement("td");
        tagCell.textContent = player.tag;
        tr.appendChild(tagCell);

        const posCell = document.createElement("td");
        posCell.textContent = player.position;
        tr.appendChild(posCell);

        const draftedByCell = document.createElement("td");
        draftedByCell.textContent = player.draftedBy || "";
        tr.appendChild(draftedByCell);

        tableBody.appendChild(tr);
      }

      if (player.draftedBy === teamNames[myTeamIndex]) {
        const li = document.createElement("li");
        li.textContent = `${player.name} (${player.tag})`;
        document.getElementById("my" + player.position).appendChild(li);
      }
    });
  }

  function handleFileSubmit() {
    if (!fileInput.files.length) {
      alert("Please select a player file before submitting.");
      fileInput.classList.add("error");
      return;
    }
    fileInput.classList.remove("error");

    const file = fileInput.files[0];
    const reader = new FileReader();
    reader.onload = e => {
      const lines = e.target.result.split("\n").filter(line => line.trim());
      players = lines.map((line, index) => {
        const parts = line.trim().split(/\s+/);
        const tag = parts.pop();
        const name = parts.join(" ");
        let position = "OTHER";
        if (tag) {
          if (tag.includes("RB")) position = "RB";
          else if (tag.includes("WR")) position = "WR";
          else if (tag.includes("QB")) position = "QB";
          else if (tag.includes("TE")) position = "TE";
        }
        return {
          id: index + 1,
          name,
          tag,
          position,
          drafted: false,
          draftedBy: null,
          pickNumber: null,
        };
      }).filter(p => p.name && p.tag);

      currentPick = 0;
      draftOrder = [];
      saveAll();
      renderTable();
      updateCurrentPickDisplay();

      removeFileBtn.disabled = false;
      validateStartDraftButton();
    };
    reader.readAsText(file);
  }

  function removePlayerFile() {
    players = [];
    draftOrder = [];
    currentPick = 0;
    saveAll();
    renderTable();
    updateCurrentPickDisplay();
    clearFileInput();
    removeFileBtn.disabled = true;
    validateStartDraftButton();
  }

  function clearFileInput() {
    fileInput.value = "";
  }

  // Init
  populateTeamCountOptions();
  generateTeamNameInputs();
  loadAll();
  renderTable();
  updateCurrentPickDisplay();
  validateStartDraftButton();

  // Event listeners
  submitFileBtn.addEventListener("click", handleFileSubmit);
  removeFileBtn.addEventListener("click", removePlayerFile);
  searchInput.addEventListener("input", renderTable);
  fileInput.addEventListener("change", () => {
    // Just clear error on new file select, no auto loading
    fileInput.classList.remove("error");
    submitFileBtn.classList.remove("error");
    validateStartDraftButton();
  });
</script>

</body>
</html>
