<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta charset="UTF-8" />
  <title>Fantasy Draft Tool</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');
    body {
      font-family: 'Inter', sans-serif;
      background: #f5f7fa;
      color: #222;
      padding: 2rem;
      max-width: 1200px;
      margin: auto;
    }
    h2, h3 {
      font-weight: 600;
      color: #333;
      margin-bottom: 1rem;
    }
    .controls {
      margin-bottom: 1.5rem;
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      align-items: center;
    }
    .controls > * {
      flex-grow: 1;
      min-width: 120px;
    }
    input[type="file"],
    input[type="text"],
    select {
      padding: 0.6rem 0.8rem;
      border-radius: 6px;
      border: 1.8px solid #ccc;
      font-size: 1rem;
      transition: border-color 0.3s ease;
    }
    input[type="file"]:hover,
    input[type="file"]:focus,
    input[type="text"]:focus,
    select:focus {
      border-color: #007bff;
      outline: none;
    }
    button {
      background-color: #007bff;
      border: none;
      color: white;
      padding: 0.6rem 1.2rem;
      font-weight: 600;
      border-radius: 6px;
      cursor: pointer;
      box-shadow: 0 3px 8px rgb(0 123 255 / 0.3);
    }
    button:hover:not(:disabled) {
      background-color: #0056b3;
    }
    button:disabled {
      background-color: #a3c3f7;
      cursor: not-allowed;
    }
    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0 8px;
      background: white;
      box-shadow: 0 4px 12px rgb(0 0 0 / 0.1);
      border-radius: 8px;
    }
    th, td {
      padding: 12px 15px;
      text-align: left;
    }
    thead tr {
      background-color: #007bff;
      color: white;
    }
    tbody tr {
      background-color: #fefefe;
      transition: background-color 0.3s ease;
      cursor: pointer;
    }
    tbody tr:hover {
      background-color: #e9f1ff;
    }
    .strikethrough {
      text-decoration: line-through;
      color: #aaa;
    }
    .highlight {
      background-color: #ffeb3b !important;
      font-weight: bold;
    }
    .recent-pick {
      background-color: #fff8e1;
      border-left: 5px solid #ff8c00;
    }
  </style>
</head>
<body>

<h2>Fantasy Draft Board</h2>

<div class="controls">
  <input type="file" id="fileInput" accept=".txt" />
  <button id="submitFileBtn">Submit File</button>
  <button id="removeFileBtn" disabled>Remove File</button>
  <input type="text" id="searchInput" placeholder="Search players..." />
  <button onclick="filterByPosition('ALL')">ALL</button>
  <button onclick="filterByPosition('RB')">RB</button>
  <button onclick="filterByPosition('WR')">WR</button>
  <button onclick="filterByPosition('QB')">QB</button>
  <button onclick="filterByPosition('TE')">TE</button>
  <label><input type="checkbox" id="hidePickedCheckbox" onchange="renderTable()" /> Hide Picked</label>
  <button onclick="resetAll()">Reset All</button>
</div>

<h3>Your Picks</h3>
<div class="my-picks">
  <div><strong>QB</strong><ul id="myQB"></ul></div>
  <div><strong>RB</strong><ul id="myRB"></ul></div>
  <div><strong>WR</strong><ul id="myWR"></ul></div>
  <div><strong>TE</strong><ul id="myTE"></ul></div>
</div>

<table id="playerTable">
  <thead>
    <tr>
      <th>‚úî</th>
      <th>#</th>
      <th>Name</th>
      <th>Position</th>
      <th>Drafted By</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
let players = [];

function renderTable() {
  const tbody = document.querySelector("#playerTable tbody");
  tbody.innerHTML = "";
  players.forEach(p => {
    const tr = document.createElement("tr");
    tr.classList.add(p.position);
    if (p.drafted) tr.classList.add("strikethrough");
    const cb = document.createElement("input");
    cb.type = "checkbox";
    cb.checked = p.drafted;
    cb.addEventListener("change", () => toggleDrafted(p.id));
    const cbCell = document.createElement("td");
    cbCell.appendChild(cb);
    tr.appendChild(cbCell);

    const idCell = document.createElement("td");
    idCell.textContent = p.id;
    tr.appendChild(idCell);

    const nameCell = document.createElement("td");
    nameCell.textContent = p.name;
    tr.appendChild(nameCell);

    const posCell = document.createElement("td");
    posCell.textContent = p.position;
    tr.appendChild(posCell);

    const draftedByCell = document.createElement("td");
    draftedByCell.textContent = p.draftedBy || "";
    tr.appendChild(draftedByCell);

    tbody.appendChild(tr);
  });
}

function toggleDrafted(id) {
  const player = players.find(p => p.id === id);
  if (!player) return;
  player.drafted = !player.drafted;
  renderTable();
}

document.getElementById("submitFileBtn").addEventListener("click", () => {
  const file = document.getElementById("fileInput").files[0];
  if (!file) return alert("Choose a file first.");
  const reader = new FileReader();
  reader.onload = e => {
    const lines = e.target.result.split("\n").filter(Boolean);
    players = lines.map((line, i) => {
      const parts = line.trim().split(/\s+/);
      const tag = parts.pop();
      const name = parts.join(" ");
      let pos = "OTHER";
      if (tag.includes("RB")) pos = "RB";
      if (tag.includes("WR")) pos = "WR";
      if (tag.includes("QB")) pos = "QB";
      if (tag.includes("TE")) pos = "TE";
      return { id: i + 1, name, tag, position: pos, drafted: false, draftedBy: null };
    });
    renderTable();
  };
  reader.readAsText(file);
});

function resetAll() {
  players = players.map(p => ({ ...p, drafted: false, draftedBy: null }));
  renderTable();
}

function filterByPosition(pos) {
  document.querySelectorAll("#playerTable tbody tr").forEach(row => {
    const show = pos === "ALL" || row.classList.contains(pos);
    row.style.display = show ? "" : "none";
  });
}

// Handle messages from extension
window.addEventListener("message", (event) => {
  if (event.data?.type === "DRAFTED_PLAYERS") {
    const picks = event.data.payload;
    console.log("üì© Received drafted picks:", picks);
    picks.forEach(pickedName => {
      const rows = document.querySelectorAll("#playerTable tbody tr");
      for (const row of rows) {
        const nameCell = row.cells[2]; // 3rd column is Name
        if (nameCell && nameCell.textContent.trim().toLowerCase().includes(pickedName.toLowerCase())) {
          const checkbox = row.querySelector("input[type='checkbox']");
          if (checkbox && !checkbox.checked) {
            checkbox.click();
            console.log("‚òëÔ∏è Auto-checked:", pickedName);
          }
          break;
        }
      }
    });
  }
});
</script>
</body>
</html>
